<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BIO-QUEST — The Living Universe Adventure</title>
  <style>
    /* ---------- Base & Theme ---------- */
    :root{
      --bg:#071023; --card:#0e1724; --accent:#39f0d6; --accent2:#7b61ff; --muted:#98a0b3;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box; font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    html,body{height:100%; margin:0; background: radial-gradient(1200px 600px at 10% 10%, rgba(59,130,246,0.06), transparent), linear-gradient(180deg, #020412 0%, #071023 100%); color:#dfe9f3}
    .app{display:flex;min-height:100vh;align-items:center;justify-content:center;padding:28px}
    .shell{width:1100px;max-width:98%;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:18px;box-shadow:0 10px 40px rgba(2,6,23,0.6);overflow:hidden;display:grid;grid-template-columns:360px 1fr}
    /* ---------- Sidebar ---------- */
    .sidebar{padding:22px;background:linear-gradient(180deg, rgba(11,18,30,0.6), rgba(8,12,20,0.5));backdrop-filter:blur(6px)}
    .logo{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    .logo .mark{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 6px 18px rgba(59,130,246,0.18)}
    h1.title{font-size:18px;margin:0}
    p.credit{color:var(--muted);font-size:12px;margin-top:6px}
    .menu{margin-top:18px;display:flex;flex-direction:column;gap:10px}
    .menu button{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:12px;border-radius:10px;color:var(--accent);text-align:left;cursor:pointer;display:flex;gap:12px;align-items:center;transition: all 0.3s ease;}
    .menu button:hover {transform: translateX(5px);}
    .menu button.active{background:linear-gradient(90deg, rgba(57,240,214,0.06), rgba(123,97,255,0.04));border-color:rgba(123,97,255,0.18);box-shadow:0 6px 18px rgba(123,97,255,0.06)}
    .muteRow{display:flex;gap:10px;margin-top:14px;align-items:center}
    input[type=range]{width:100%}
    /* ---------- Main ---------- */
    .main{padding:28px}
    .topbar{display:flex;justify-content:space-between;align-items:center}
    .world-map{margin-top:20px;display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .zone{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;cursor:pointer;border:1px solid rgba(255,255,255,0.03);position:relative;overflow:hidden;transition: all 0.3s ease;}
    .zone:hover {transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.2);}
    .zone h3{margin:0 0 8px 0}
    .zone p{margin:0;color:var(--muted);font-size:13px}
    .particle{position:absolute;right:-40px;top:-40px;width:160px;height:160px;opacity:0.06}
    /* ---------- Card & Game area ---------- */
    .card{margin-top:18px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .question{font-size:18px;margin-bottom:12px}
    .choices{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .choice{padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);cursor:pointer;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);transition: all 0.2s ease;}
    .choice:hover {transform: scale(1.02); background: linear-gradient(180deg, rgba(255,255,255,0.03), transparent);}
    .choice.correct{outline:3px solid rgba(57,240,214,0.18); animation: pulseCorrect 1s;}
    .choice.wrong{animation:shake 620ms}
    .hud{display:flex;gap:12px;align-items:center}
    .meter{background:var(--glass);padding:8px;border-radius:8px;font-size:13px;color:var(--muted);transition: all 0.3s ease;}
    .meter:hover {transform: scale(1.05);}
    .footerCredit{position:absolute;left:18px;bottom:14px;color:var(--muted);font-size:12px}
    .bigMap{display:flex;gap:12px;align-items:center}

    /* Memory Game Styles */
    .memory-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 15px;
    }
    
    .memory-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin: 15px auto;
      max-width: 500px;
    }
    
    .memory-card {
      width: 100px;
      height: 100px;
      perspective: 1000px;
      cursor: pointer;
    }
    
    .memory-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    
    .memory-card.flipped .memory-card-inner {
      transform: rotateY(180deg);
    }
    
    .memory-card-front, .memory-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      box-sizing: border-box;
    }
    
    .memory-card-front {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: white;
      font-weight: bold;
    }
    
    .memory-card-back {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      transform: rotateY(180deg);
      font-size: 14px;
      text-align: center;
    }
    
    .memory-card.matched .memory-card-back {
      background: rgba(57,240,214,0.2);
      border-color: var(--accent);
    }
    
    .memory-stats {
      display: flex;
      gap: 20px;
      margin-top: 15px;
    }
    
    .memory-controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .memory-message {
      text-align: center;
      margin-top: 10px;
      min-height: 20px;
      font-weight: bold;
    }
    
    .memory-message.success {
      color: var(--accent);
    }

    /* DNA Shooter Styles */
    .dna-target { 
      position: absolute; 
      cursor: pointer; 
      border-radius: 50%; 
    }
    
    .game-score { 
      margin-top: 10px; 
      font-weight: bold; 
    }

    /* responsive */
    @media(max-width:900px){
      .shell{grid-template-columns:1fr}
      .sidebar{display:none}
      .world-map{grid-template-columns:1fr}
      .choices{grid-template-columns:1fr}
      .memory-grid{grid-template-columns:repeat(3, 1fr); max-width:100%}
      .memory-card{width:80px; height:80px}
      .hud{flex-wrap:wrap; justify-content:center}
      .topbar{flex-direction:column; gap:10px}
      .bigMap{flex-direction:column; text-align:center}
      #progressBar{width:100%}
    }
    
    @media(max-width:600px){
      .app{padding:10px}
      .main{padding:15px}
      .card{padding:12px}
      .memory-card{width:70px; height:70px}
      .memory-card-back{font-size:12px}
      .memory-grid{grid-template-columns:repeat(3, 1fr); gap:8px}
      .question{font-size:16px}
      .zone{padding:12px}
    }

    /* Mobile menu */
    .mobile-menu-btn {
      display: none;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--accent);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 15px;
    }
    
    @media(max-width:900px){
      .mobile-menu-btn {
        display: block;
      }
      .sidebar.mobile-open {
        display: block;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100;
        overflow-y: auto;
      }
    }

    /* --- Enhanced Animations --- */
    @keyframes floatDNA { 0%{transform:translateY(0) rotate(0deg);} 50%{transform:translateY(-12px) rotate(6deg);} 100%{transform:translateY(0) rotate(0deg);} }
    @keyframes pulseGlow { 0%{box-shadow:0 0 10px #00eaff;} 50%{box-shadow:0 0 25px #00eaff;} 100%{box-shadow:0 0 10px #00eaff;} }
    @keyframes slideFadeIn { 0%{opacity:0; transform:translateY(40px);} 100%{opacity:1; transform:translateY(0);} }
    @keyframes rotateHelix { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
    @keyframes pulseCorrect { 0%{box-shadow: 0 0 0 0 rgba(57,240,214,0.4);} 70%{box-shadow: 0 0 0 10px rgba(57,240,214,0);} 100%{box-shadow: 0 0 0 0 rgba(57,240,214,0);} }
    @keyframes shake { 
      0%, 100% {transform: translateX(0);} 
      10%, 30%, 50%, 70%, 90% {transform: translateX(-5px);} 
      20%, 40%, 60%, 80% {transform: translateX(5px);} 
    }

    .dna-float { animation: floatDNA 4s ease-in-out infinite; }
    .glow-pulse { animation: pulseGlow 2.5s infinite; }
    .slide-in { animation: slideFadeIn 1s ease forwards; }
    .helix-spin { animation: rotateHelix 14s linear infinite; }

    /* Music button styles */
    .music-controls {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .music-btn {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.04);
      padding: 8px 12px;
      border-radius: 8px;
      color: var(--accent);
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s ease;
    }

    .music-btn:hover {
      background: linear-gradient(90deg, rgba(57,240,214,0.06), rgba(123,97,255,0.04));
      border-color: rgba(123,97,255,0.18);
      transform: scale(1.05);
    }

    .music-btn.active {
      background: linear-gradient(90deg, rgba(57,240,214,0.1), rgba(123,97,255,0.08));
      border-color: rgba(123,97,255,0.3);
      box-shadow: 0 4px 12px rgba(123,97,255,0.1);
    }

    /* Zone Icons */
    .zone-icon {
      width: 40px;
      height: 40px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      animation: floatDNA 4s ease-in-out infinite;
    }
  </style>
</head>
<body class="slide-in">
  <!-- Audio element untuk backsound -->
  <audio id="bgMusic" loop>
    <source src="https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3" type="audio/mpeg">
    Browser Anda tidak mendukung elemen audio.
  </audio>
  
  <div class="app">
    <div class="shell">
      <aside class="sidebar" id="sidebar">
        <div class="logo">
          <div class="mark dna-float">BQ</div>
          <div>
            <h1 class="title">BIO-QUEST</h1>
            <p class="credit">The Living Universe Adventure</p>
          </div>
        </div>
        <div class="menu" id="menu">
          <button data-screen="home" class="active">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            World Map
          </button>
          <button data-screen="play">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            Play Zone
          </button>
          <button data-screen="minigames">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polygon points="10 8 16 12 10 16 10 8"></polygon>
            </svg>
            Mini Games
          </button>
          <button data-screen="leader">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="8.5" cy="7" r="4"></circle>
              <polyline points="17 11 19 13 23 9"></polyline>
            </svg>
            Leaderboard
          </button>
          <button data-screen="credits">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            Credits
          </button>
        </div>
        <div class="muteRow">
          <label style="font-size:13px;color:var(--muted);">Volume</label>
          <input id="vol" type="range" min="0" max="1" step="0.01" value="0.6">
        </div>
        <div class="music-controls">
          <button id="btnMute">Mute</button>
          <button id="btnTheme">Mode</button>
          <button id="btnMusic" class="music-btn">Music On</button>
        </div>
        <div class="footerCredit">Dibuat oleh Nasrul & Dwi – SMAN KABUH JOMBANG 2025</div>
      </aside>

      <main class="main">
        <button class="mobile-menu-btn" id="mobileMenuBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
          Menu
        </button>
        
        <div class="topbar">
          <div class="hud">
            <div class="meter">XP: <span id="xp">0</span></div>
            <div class="meter">Nucleus Points: <span id="coins">0</span></div>
            <div class="meter">Lives: <span id="lives">3</span></div>
          </div>
          <div>
            <button id="btnHelp">Help</button>
          </div>
        </div>

        <section id="screen_home" class="screen">
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px">
              <div>
                <h2 style="margin:0">World Map</h2>
                <p style="margin:6px 0 0 0;color:var(--muted)">Pilih zona untuk memulai petualangan biologi</p>
              </div>
              <div class="bigMap">
                <div style="text-align:right"><small style="color:var(--muted)">Progress</small><div id="progressBar" style="width:180px;height:10px;background:rgba(255,255,255,0.03);border-radius:6px;overflow:hidden"><div id="progressFill" style="height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))"></div></div></div>
              </div>
            </div>

            <div class="world-map">
              <div class="zone" data-zone="cell" tabindex="0">
                <div class="zone-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </div>
                <h3>Micro Cell World</h3>
                <p>Jelajahi organel, jawab soal tentang sel.</p>
                <svg class="particle" viewBox="0 0 100 100"><circle cx="40" cy="40" r="30" fill="white"/></svg>
              </div>
              <div class="zone" data-zone="system">
                <div class="zone-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
                  </svg>
                </div>
                <h3>Human System Lab</h3>
                <p>Sistem organ manusia & fungsi.</p>
                <svg class="particle" viewBox="0 0 100 100"><rect x="20" y="20" width="60" height="60"/></svg>
              </div>
              <div class="zone" data-zone="plant">
                <div class="zone-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
                  </svg>
                </div>
                <h3>Plant Planet</h3>
                <p>Fotosintesis & struktur tanaman.</p>
                <svg class="particle" viewBox="0 0 100 100"><path d="M10 80 Q 50 10 90 80 Z"/></svg>
              </div>
              <div class="zone" data-zone="dna">
                <div class="zone-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 6.1H7M17 6.1C19 6.1 21 7.1 21 9.1V15.1C21 17.1 19 18.1 17 18.1H7C5 18.1 3 17.1 3 15.1V9.1C3 7.1 5 6.1 7 6.1M17 6.1V5C17 3 16 2 14 2H10C8 2 7 3 7 5V6.1"></path>
                    <path d="M12 11V16"></path>
                    <path d="M9 13H15"></path>
                  </svg>
                </div>
                <h3>DNA Galaxy</h3>
                <p>Genetika & struktur DNA.</p>
                <svg class="particle" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40"/></svg>
              </div>
              <div class="zone" data-zone="eco">
                <div class="zone-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12l2 2 4-4"></path>
                    <path d="M5 7c0-1.1.9-2 2-2h10a2 2 0 0 1 2 2v12H5V7z"></path>
                  </svg>
                </div>
                <h3>Eco Forest Realm</h3>
                <p>Ekologi, rantai makanan, hubungan species.</p>
                <svg class="particle" viewBox="0 0 100 100"><ellipse cx="50" cy="50" rx="40" ry="20"/></svg>
              </div>
              <div class="zone" data-zone="evo">
                <div class="zone-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </div>
                <h3>Evolution Time Rift</h3>
                <p>Proses evolusi & adaptasi.</p>
                <svg class="particle" viewBox="0 0 100 100"><polyline points="10,80 30,20 50,60 70,10 90,80"/></svg>
              </div>
            </div>
          </div>
        </section>

        <section id="screen_play" class="screen" style="display:none">
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px">
              <h2 id="zoneTitle">Zone</h2>
              <div><small style="color:var(--muted)">Level</small> <strong id="zoneLevel">1</strong></div>
            </div>
            <div style="margin-top:12px" id="gameArea">
              <!-- Game content injected here -->
              <div class="question" id="question">Pilih zone dahulu dari World Map.</div>
              <div class="choices" id="choices"></div>
            </div>
            <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
              <button id="btnNext">Next</button>
            </div>
          </div>
        </section>

        <section id="screen_minigames" class="screen" style="display:none">
          <div class="card">
            <h2>Mini Games</h2>
            <p style="color:var(--muted)">Pilih mini game untuk bermain — setiap mini game memberi XP & Points.</p>
            <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap">
              <button class="mini" data-min="memory">Biology Memory Match</button>
              <button class="mini" data-min="shooter">DNA Shooter</button>
              <button class="mini" data-min="drag">Drag & Drop Anatomy</button>
            </div>
            <div id="miniArea" style="margin-top:12px"></div>
          </div>
        </section>

        <section id="screen_leader" class="screen" style="display:none">
          <div class="card">
            <h2>Leaderboard (Local)</h2>
            <div id="leaderList" style="margin-top:10px"></div>
          </div>
        </section>

        <section id="screen_credits" class="screen" style="display:none">
          <div class="card">
            <h2>Credits</h2>
            <p>Dibuat oleh <strong>Nasrul & Dwi</strong> — <em>SMAN KABUH JOMBANG 2025</em></p>
            <p style="color:var(--muted)">Terima kasih telah menggunakan BIO-QUEST. Silakan fork repo ini jika ingin mengembangkan lebih lanjut.</p>
          </div>
        </section>

      </main>
    </div>
  </div>

  <script>
    // ---------- Data: 30+ Questions ----------
    const QUESTIONS = {
      cell: [
        {q:'Organel manakah yang dikenal sebagai "pabrik energi" sel?', choices:['Ribosom','Mitokondria','Kloroplas','Retikulum Endoplasma'], a:1},
        {q:'Bagian sel yang berfungsi menyimpan materi genetik adalah?', choices:['Mitokondria','Nukleus','Lisosom','Golgi'], a:1},
        {q:'Struktur yang hanya ditemukan pada sel tumbuhan, bukan sel hewan?', choices:['Dinding sel','Mitokondria','Ribosom','Nukleus'], a:0},
        {q:'Organel yang terlibat sintesis protein adalah?', choices:['Ribosom','Peroksisom','Lisosom','Kloroplas'], a:0},
        {q:'Organel yang memodifikasi dan mengemas protein adalah?', choices:['Retikulum Endoplasma','Golgi Apparatus','Nukleus','Vakuola'], a:1}
      ],
      system: [
        {q:'Sistem tubuh yang bertanggung jawab mengangkut oksigen adalah?', choices:['Sistem Pencernaan','Sistem Peredaran Darah','Sistem Saraf','Sistem Rangka'], a:1},
        {q:'Organ utama pencernaan yang menyerap nutrisi adalah?', choices:['Lambung','Usus Halus','Hati','Pankreas'], a:1},
        {q:'Bagian otak yang mengatur keseimbangan dan koordinasi?', choices:['Serebrum','Serebelum','Medula Oblongata','Hipotalamus'], a:1},
        {q:'Organ yang memompa darah ke seluruh tubuh adalah?', choices:['Paru-paru','Jantung','Hati','Ginjal'], a:1},
        {q:'Sistem yang melindungi tubuh dari patogen disebut?', choices:['Sistem Kekebalan','Sistem Peredaran','Sistem Endokrin','Sistem Muskuloskeletal'], a:0}
      ],
      plant: [
        {q:'Tempat terjadinya fotosintesis pada tumbuhan adalah?', choices:['Kloroplas','Mitokondria','Vakuola','Nukleus'], a:0},
        {q:'Gas yang dilepaskan selama fotosintesis adalah?', choices:['Karbon Dioksida','Nitrogen','Oksigen','Metana'], a:2},
        {q:'Bagian daun yang mengontrol keluar masuknya gas disebut?', choices:['Stomata','Xilem','Floem','Epidermis'], a:0},
        {q:'Pigmen hijau yang menangkap cahaya adalah?', choices:['Klorofil','Kartonoid','Melanin','Hemoglobin'], a:0},
        {q:'Fotosintesis membutuhkan cahaya, water, dan ...?', choices:['Karbon Monoksida','Karbon Dioksida','Oksigen','Nitrogen'], a:1}
      ],
      dna: [
        {q:'Unit dasar hereditas yang membawa informasi genetik disebut?', choices:['Kromosom','Gen','Nukleus','Protein'], a:1},
        {q:'Basa nukleotida yang menggantikan timin pada RNA adalah?', choices:['Adenin','Urasil','Guanin','Sitosin'], a:1},
        {q:'Pasangan basa pada DNA: Adenin berpasangan dengan?', choices:['Guanin','Timin','Sitosin','Uracil'], a:1},
        {q:'Proses membuat salinan RNA dari DNA disebut?', choices:['Transkripsi','Translasi','Replikasi','Mutasi'], a:0},
        {q:'Bentuk struktur DNA yang terkenal adalah?', choices:['Heliks ganda','Lattice','Ring','Triple helix'], a:0}
      ],
      eco: [
        {q:'Produsen primer di ekosistem biasanya adalah?', choices:['Herbivora','Karnivora','Tumbuhan','Detritivor'], a:2},
        {q:'Interaksi ekologis ketika satu organisme diuntungkan dan yang lain tidak terpengaruh disebut?', choices:['Mutualisme','Komensalisme','Parasitisme','Predasi'], a:1},
        {q:'Rantai makanan: rumput -> kelinci -> serigala. Apa peran kelinci?', choices:['Konsumen primer','Produsen','Konsumen sekunder','Dekomposer'], a:0},
        {q:'Apa yang dimaksud biodiversitas?', choices:['Keragaman genetik, spesies & ekosistem','Jumlah pohon di hutan','Jumlah predator di suatu area','Jumlah monokultur pertanian'], a:0},
        {q:'Siklus yang melibatkan evaporasi, kondensasi, & presipitasi?', choices:['Siklus Karbon','Siklus Nitrogen','Siklus Air','Siklus Fosfor'], a:2}
      ],
      evo: [
        {q:'Teori evolusi modern dikembangkan terutama oleh siapa?', choices:['Lamark','Darwin','Mendel','Huxley'], a:1},
        {q:'Proses perubahan frekuensi gen dalam populasi disebut?', choices:['Seleksi Alam','Mutasi','Migrasi','Deriva Genetik'], a:3},
        {q:'Adaptasi meningkatkan ... pada organisme?', choices:['Kemampuan bertahan hidup & reproduksi','Ukuran tubuh','Kecantikan','Jumlah kromosom'], a:0},
        {q:'Fosil memberikan bukti tentang ...?', choices:['Perkembangan evolusi','Perbedaan warna','Jumlah water pada masa lalu','Makanan dinosaurus'], a:0},
        {q:'Spesiasi adalah proses terbentuknya ...?', choices:['Spesies baru','Mutasi tunggal','Gen baru','Sel baru'], a:0}
      ]
    };

    // ---------- State ----------
    let state = {
      xp: 0,
      coins: 0,
      lives: 3,
      progress: 0,
      currentZone: null,
      qIndex: 0,
      zoneQuestions: [],
      zoneLevel: 1
    };

    // ---------- DOM ----------
    const screens = Array.from(document.querySelectorAll('.screen'));
    const menu = document.getElementById('menu');
    const choicesEl = document.getElementById('choices');
    const questionEl = document.getElementById('question');
    const xpEl = document.getElementById('xp');
    const coinsEl = document.getElementById('coins');
    const livesEl = document.getElementById('lives');
    const zones = document.querySelectorAll('.zone');
    const progressFill = document.getElementById('progressFill');
    const zoneLevelEl = document.getElementById('zoneLevel');
    const zoneTitleEl = document.getElementById('zoneTitle');
    const bgMusic = document.getElementById('bgMusic');
    const sidebar = document.getElementById('sidebar');
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');

    // Game variables
    let gameIntervals = [];
    let musicStarted = false;

    // ---------- Background Music ----------
    function startBackgroundMusic() {
      if (musicStarted) return;
      
      // Setel volume awal
      bgMusic.volume = document.getElementById('vol').value;
      
      // Coba putar musik
      bgMusic.play().then(() => {
        musicStarted = true;
        console.log('Background music started');
        document.getElementById('btnMusic').textContent = 'Music On';
        document.getElementById('btnMusic').classList.add('active');
      }).catch(error => {
        console.log('Autoplay prevented:', error);
        // Tampilkan pesan bahwa musik tidak dapat dimulai otomatis
        alert('Klik tombol "Music On" untuk memulai backsound.');
      });
    }
    
    // Fungsi untuk menghentikan/memulai musik
    function toggleMusic() {
      if (bgMusic.paused) {
        bgMusic.play();
        document.getElementById('btnMusic').textContent = 'Music On';
        document.getElementById('btnMusic').classList.add('active');
      } else {
        bgMusic.pause();
        document.getElementById('btnMusic').textContent = 'Music Off';
        document.getElementById('btnMusic').classList.remove('active');
      }
    }

    // ---------- Simple audio via WebAudio (synth) ----------
    let audioCtx, masterGain;
    
    function initAudio() {
      try {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        masterGain = audioCtx.createGain();
        masterGain.gain.value = 0.6;
        masterGain.connect(audioCtx.destination);
      } catch (e) {
        console.log('Web Audio API tidak didukung:', e);
      }
    }
    
    function playTone(freq = 440, duration = 0.12, type = 'sine', vol = 0.5) {
      if (!audioCtx) return;
      
      try {
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = type;
        o.frequency.value = freq;
        g.gain.value = vol;
        o.connect(g);
        g.connect(masterGain);
        o.start();
        o.stop(audioCtx.currentTime + duration);
      } catch (e) {
        console.log('Error playing tone:', e);
      }
    }
    
    function successSfx() {
      playTone(880, 0.12, 'sine', 0.2);
      playTone(1320, 0.08, 'sine', 0.12);
    }
    
    function wrongSfx() {
      playTone(180, 0.18, 'sawtooth', 0.18);
    }
    
    function clickSfx() {
      playTone(880, 0.04, 'square', 0.06);
    }

    // ---------- Interaction ----------
    menu.addEventListener('click', e => {
      const b = e.target.closest('button');
      if (!b) return;
      Array.from(menu.children).forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      showScreen(b.dataset.screen);
      // Tutup menu mobile setelah memilih
      if (window.innerWidth <= 900) {
        sidebar.classList.remove('mobile-open');
      }
    });
    
    document.getElementById('vol').addEventListener('input', e => {
      if (masterGain) masterGain.gain.value = e.target.value;
      bgMusic.volume = e.target.value;
    });
    
    document.getElementById('btnMute').addEventListener('click', () => {
      if (masterGain) masterGain.gain.value = 0;
      bgMusic.volume = 0;
      document.getElementById('vol').value = 0;
    });
    
    document.getElementById('btnTheme').addEventListener('click', () => {
      document.body.classList.toggle('light');
      alert('Mode tema berganti (demo)');
    });
    
    document.getElementById('btnNext').addEventListener('click', () => {
      nextQuestion();
    });

    document.getElementById('btnHelp').addEventListener('click', () => {
      alert('BIO-QUEST Help:\n\n1. Pilih zona dari World Map\n2. Jawab pertanyaan dengan benar untuk mendapatkan XP\n3. Gunakan Nucleus Points untuk membuka fitur baru\n4. Main mini games untuk bonus XP\n5. Jaga lives Anda!');
    });

    document.getElementById('btnMusic').addEventListener('click', toggleMusic);

    zones.forEach(z => z.addEventListener('click', () => {
      openZone(z.dataset.zone);
    }));

    // Mobile menu toggle
    mobileMenuBtn.addEventListener('click', () => {
      sidebar.classList.toggle('mobile-open');
    });

    function showScreen(name) {
      screens.forEach(s => s.style.display = 'none');
      document.getElementById('screen_' + name).style.display = '';
    }

    function openZone(zone) {
      clickSfx();
      state.currentZone = zone;
      state.qIndex = 0;
      state.zoneLevel = 1;
      state.zoneQuestions = shuffleArray([...QUESTIONS[zone]]);
      zoneTitleEl.innerText = humanize(zone);
      zoneLevelEl.innerText = state.zoneLevel;
      showScreen('play');
      renderQuestion();
    }

    function renderQuestion() {
      const z = state.currentZone;
      if (!z) {
        questionEl.innerText = 'Pilih zone dahulu dari World Map.';
        choicesEl.innerHTML = '';
        return;
      }
      
      const q = state.zoneQuestions[state.qIndex];
      if (!q) {
        // All questions answered for this zone
        questionEl.innerText = 'Selamat! Anda telah menyelesaikan semua pertanyaan di zona ini.';
        choicesEl.innerHTML = '';
        state.progress += 1;
        state.xp += 50; // Bonus for completing zone
        state.coins += 25;
        updateHUD();
        updateProgress();
        return;
      }
      
      questionEl.innerText = q.q;
      choicesEl.innerHTML = '';
      q.choices.forEach((c, i) => {
        const d = document.createElement('div');
        d.className = 'choice';
        d.innerText = c;
        d.tabIndex = 0;
        d.addEventListener('click', () => answer(i));
        choicesEl.appendChild(d);
      });
    }

    function answer(i) {
      const q = state.zoneQuestions[state.qIndex];
      const choices = document.querySelectorAll('.choice');
      
      if (typeof i !== 'number') return;
      
      // Remove any existing correct/wrong classes
      choices.forEach(choice => {
        choice.classList.remove('correct', 'wrong');
      });
      
      if (i === q.a) {
        choices[i].classList.add('correct');
        successSfx();
        state.xp += 10;
        state.coins += 5;
        state.qIndex += 1;
        
        // Level up every 2 questions
        if (state.qIndex % 2 === 0) {
          state.zoneLevel += 1;
          zoneLevelEl.innerText = state.zoneLevel;
        }
        
        setTimeout(() => {
          renderQuestion();
          updateHUD();
        }, 800);
      } else {
        choices[i].classList.add('wrong');
        wrongSfx();
        state.lives -= 1;
        updateHUD();
        if (state.lives <= 0) {
          gameOver();
        }
      }
    }

    function nextQuestion() {
      if (!state.currentZone) return;
      state.qIndex += 1;
      renderQuestion();
    }

    function updateHUD() {
      xpEl.innerText = state.xp;
      coinsEl.innerText = state.coins;
      livesEl.innerText = state.lives;
    }

    function updateProgress() {
      const tot = 6;
      const perc = Math.min(100, Math.round((state.progress / tot) * 100));
      progressFill.style.width = perc + '%';
    }

    function gameOver() {
      alert('Game over! Anda kehabisan nyawa. Progress disimpan ke leaderboard.');
      saveToLeader();
      state.xp = 0;
      state.coins = 0;
      state.lives = 3;
      state.progress = 0;
      updateHUD();
      updateProgress();
      showScreen('home');
    }

    function saveToLeader() {
      const name = prompt('Masukkan nama pemain (untuk leaderboard):', 'Player');
      if (!name) return;
      const arr = JSON.parse(localStorage.getItem('bq_leader') || '[]');
      arr.push({
        name,
        xp: state.xp,
        coins: state.coins,
        date: new Date().toISOString()
      });
      arr.sort((a, b) => b.xp - a.xp);
      localStorage.setItem('bq_leader', JSON.stringify(arr.slice(0, 10)));
      renderLeader();
    }

    function renderLeader() {
      const arr = JSON.parse(localStorage.getItem('bq_leader') || '[]');
      const el = document.getElementById('leaderList');
      if (!el) return;
      el.innerHTML = arr.map((r, i) => 
        `<div style="padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03)">
          ${i + 1}. <strong>${r.name}</strong> — XP: ${r.xp} — Coins: ${r.coins} 
          <small style="color:var(--muted);">${(new Date(r.date)).toLocaleString()}</small>
        </div>`
      ).join('');
    }

    // ---------- Mini games (FIXED implementations) ----------
    document.querySelectorAll('.mini').forEach(b => b.addEventListener('click', e => {
      const m = e.target.dataset.min;
      startMini(m);
      showScreen('minigames');
    }));

    // Clear all game intervals
    function clearAllGameIntervals() {
      gameIntervals.forEach(interval => clearInterval(interval));
      gameIntervals = [];
    }
    
    function startMini(name) {
      const area = document.getElementById('miniArea');
      area.innerHTML = '';
      
      // Clear any existing game intervals
      clearAllGameIntervals();
      
      if (name === 'memory') {
        area.innerHTML = `
          <p><strong>Biology Memory Match:</strong> Temukan pasangan yang cocok!</p>
          <div class="memory-container">
            <div class="memory-stats">
              <div>Waktu: <span id="memoryTime">60</span>s</div>
              <div>Pasangan Ditemukan: <span id="memoryMatches">0</span>/6</div>
              <div>Gerakan: <span id="memoryMoves">0</span></div>
            </div>
            <div class="memory-grid" id="memoryGrid"></div>
            <div class="memory-controls">
              <button id="memoryReset">Ulangi</button>
              <button id="memoryHint">Bantuan</button>
            </div>
            <div class="memory-message" id="memoryMessage"></div>
          </div>
          <button id="endMini">Selesai</button>
        `;
        
        // Memory game data
        const memoryCards = [
          { id: 1, name: 'Mitokondria', desc: 'Pabrik energi sel' },
          { id: 2, name: 'Nukleus', desc: 'Pusat kendali sel' },
          { id: 3, name: 'Kloroplas', desc: 'Tempat fotosintesis' },
          { id: 4, name: 'Ribosom', desc: 'Sintesis protein' },
          { id: 5, name: 'DNA', desc: 'Pembawa informasi genetik' },
          { id: 6, name: 'Enzim', desc: 'Katalis biologis' }
        ];
        
        // Duplicate and shuffle cards
        let gameCards = [...memoryCards, ...memoryCards];
        gameCards = shuffleArray(gameCards);
        
        // Game state
        let memoryState = {
          flippedCards: [],
          matchedPairs: 0,
          moves: 0,
          timeLeft: 60,
          timer: null,
          canFlip: true
        };
        
        // Create memory cards
        const memoryGrid = document.getElementById('memoryGrid');
        memoryGrid.innerHTML = '';
        
        gameCards.forEach((card, index) => {
          const cardElement = document.createElement('div');
          cardElement.className = 'memory-card';
          cardElement.dataset.id = card.id;
          cardElement.dataset.index = index;
          
          cardElement.innerHTML = `
            <div class="memory-card-inner">
              <div class="memory-card-front">
                <span>?</span>
              </div>
              <div class="memory-card-back">
                <strong>${card.name}</strong><br>
                <small>${card.desc}</small>
              </div>
            </div>
          `;
          
          cardElement.addEventListener('click', () => flipCard(cardElement));
          memoryGrid.appendChild(cardElement);
        });
        
        // Start timer
        memoryState.timer = setInterval(() => {
          memoryState.timeLeft--;
          document.getElementById('memoryTime').textContent = memoryState.timeLeft;
          
          if (memoryState.timeLeft <= 0) {
            endMemoryGame(false);
          }
        }, 1000);
        
        // Flip card function
        function flipCard(cardElement) {
          if (!memoryState.canFlip || 
              cardElement.classList.contains('flipped') || 
              cardElement.classList.contains('matched') ||
              memoryState.flippedCards.length >= 2) {
            return;
          }
          
          clickSfx();
          cardElement.classList.add('flipped');
          memoryState.flippedCards.push(cardElement);
          
          if (memoryState.flippedCards.length === 2) {
            memoryState.moves++;
            document.getElementById('memoryMoves').textContent = memoryState.moves;
            checkForMatch();
          }
        }
        
        // Check for match
        function checkForMatch() {
          memoryState.canFlip = false;
          
          const [card1, card2] = memoryState.flippedCards;
          const isMatch = card1.dataset.id === card2.dataset.id;
          
          setTimeout(() => {
            if (isMatch) {
              // Match found
              successSfx();
              card1.classList.add('matched');
              card2.classList.add('matched');
              memoryState.matchedPairs++;
              document.getElementById('memoryMatches').textContent = memoryState.matchedPairs;
              
              if (memoryState.matchedPairs === memoryCards.length) {
                endMemoryGame(true);
              }
            } else {
              // No match
              wrongSfx();
              card1.classList.remove('flipped');
              card2.classList.remove('flipped');
            }
            
            memoryState.flippedCards = [];
            memoryState.canFlip = true;
          }, 1000);
        }
        
        // End game
        function endMemoryGame(isWin) {
          clearInterval(memoryState.timer);
          
          const message = document.getElementById('memoryMessage');
          if (isWin) {
            message.textContent = `Selamat! Anda menemukan semua pasangan dalam ${memoryState.moves} gerakan!`;
            message.className = 'memory-message success';
          } else {
            message.textContent = 'Waktu habis! Coba lagi.';
          }
        }
        
        // Reset game
        document.getElementById('memoryReset').addEventListener('click', () => {
          clearInterval(memoryState.timer);
          startMini('memory');
        });
        
        // Hint system
        document.getElementById('memoryHint').addEventListener('click', () => {
          if (!memoryState.canFlip || memoryState.flippedCards.length > 0) return;
          
          // Find two unmatched cards
          const unmatchedCards = Array.from(document.querySelectorAll('.memory-card:not(.matched)'));
          if (unmatchedCards.length < 2) return;
          
          // Temporarily show a pair
          const card1 = unmatchedCards[0];
          const card2 = unmatchedCards.find(card => 
            card !== card1 && card.dataset.id === card1.dataset.id
          );
          
          if (card1 && card2) {
            card1.classList.add('flipped');
            card2.classList.add('flipped');
            
            setTimeout(() => {
              card1.classList.remove('flipped');
              card2.classList.remove('flipped');
            }, 1000);
          }
        });
        
        document.getElementById('endMini').onclick = () => {
          clearInterval(memoryState.timer);
          const score = memoryState.matchedPairs * 5 + Math.max(0, memoryState.timeLeft);
          state.xp += score;
          state.coins += Math.floor(score / 2);
          updateHUD();
          alert(`Selesai mini game — +${score} XP`);
        };
      }
      
      else if (name === 'shooter') {
        area.innerHTML = `
          <p><strong>DNA Shooter:</strong> Klik DNA yang sesuai dengan pertanyaan!</p>
          <div class="game-container" id="shooterArea" style="position:relative; height:200px; border:1px solid rgba(255,255,255,0.1); border-radius:8px; overflow:hidden"></div>
          <p class="game-score" id="shooterQuestion">Klik DNA Heliks!</p>
          <p class="game-score">Skor: <span id="shooterScore">0</span></p>
          <button id="endMini2">Selesai</button>
        `;
        
        // DNA Shooter game
        let shooterScore = 0;
        const shooterArea = document.getElementById('shooterArea');
        const questionDisplay = document.getElementById('shooterQuestion');
        const scoreDisplay = document.getElementById('shooterScore');
        
        const dnaTypes = ['Heliks', 'Lurus', 'Melingkar'];
        let currentDNA = 'Heliks';
        
        function createDNA() {
          shooterArea.innerHTML = '';
          currentDNA = dnaTypes[Math.floor(Math.random() * dnaTypes.length)];
          questionDisplay.textContent = `Klik DNA ${currentDNA}!`;
          
          // Create multiple DNA elements
          for (let i = 0; i < 5; i++) {
            const dna = document.createElement('div');
            const type = dnaTypes[Math.floor(Math.random() * dnaTypes.length)];
            const size = 30 + Math.random() * 20;
            const left = 10 + Math.random() * 80;
            const top = 20 + Math.random() * 100;
            
            dna.className = 'dna-target';
            dna.style.width = size + 'px';
            dna.style.height = size + 'px';
            dna.style.left = left + '%';
            dna.style.top = top + 'px';
            dna.style.borderRadius = type === 'Heliks' ? '50%' : '0';
            dna.style.background = type === 'Heliks' ? 'var(--accent)' : 
                                  type === 'Lurus' ? 'var(--accent2)' : '#ff6b6b';
            dna.style.transform = type === 'Melingkar' ? 'rotate(45deg)' : 'none';
            dna.dataset.type = type;
            
            dna.addEventListener('click', function() {
              if (this.dataset.type === currentDNA) {
                shooterScore++;
                scoreDisplay.textContent = shooterScore;
                this.style.background = '#4cd964';
                setTimeout(() => {
                  createDNA();
                }, 300);
              } else {
                this.style.background = '#ff3b30';
                setTimeout(() => {
                  createDNA();
                }, 300);
              }
            });
            
            shooterArea.appendChild(dna);
          }
        }
        
        createDNA();
        
        document.getElementById('endMini2').onclick = () => {
          state.xp += shooterScore * 3;
          state.coins += shooterScore;
          updateHUD();
          alert(`Selesai mini game — +${shooterScore * 3} XP`);
        };
      }
      
      else if (name === 'drag') {
        area.innerHTML = `
          <p><strong>Drag & Drop Anatomy:</strong> Seret organ ke posisi yang benar!</p>
          <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
            <div id="organs" style="width:140px;display:flex;flex-direction:column;gap:8px">
              <div class="draggable" draggable="true" data-organ="jantung" style="padding:8px;background:var(--glass);border-radius:6px;cursor:move">Jantung</div>
              <div class="draggable" draggable="true" data-organ="otak" style="padding:8px;background:var(--glass);border-radius:6px;cursor:move">Otak</div>
              <div class="draggable" draggable="true" data-organ="paru" style="padding:8px;background:var(--glass);border-radius:6px;cursor:move">Paru-paru</div>
            </div>
            <div id="bodyArea" style="flex:1;background:var(--card);padding:12px;border-radius:8px;min-height:120px;display:flex;flex-direction:column;gap:8px">
              <div class="dropzone" data-organ="jantung" style="padding:8px;border:1px dashed var(--muted);border-radius:6px;">Sistem Peredaran Darah</div>
              <div class="dropzone" data-organ="otak" style="padding:8px;border:1px dashed var(--muted);border-radius:6px;">Sistem Saraf</div>
              <div class="dropzone" data-organ="paru" style="padding:8px;border:1px dashed var(--muted);border-radius:6px;">Sistem Pernapasan</div>
            </div>
          </div>
          <p id="dragResult" style="margin-top:8px;"></p>
          <button id="endMini3">Selesai</button>
        `;
        
        // Drag and drop implementation
        const draggables = document.querySelectorAll('.draggable');
        const dropzones = document.querySelectorAll('.dropzone');
        const resultDisplay = document.getElementById('dragResult');
        
        let correctMatches = 0;
        const totalMatches = 3;
        
        draggables.forEach(draggable => {
          draggable.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.organ);
          });
        });
        
        dropzones.forEach(zone => {
          zone.addEventListener('dragover', (e) => {
            e.preventDefault();
            zone.style.background = 'rgba(57,240,214,0.1)';
          });
          
          zone.addEventListener('dragleave', () => {
            zone.style.background = '';
          });
          
          zone.addEventListener('drop', (e) => {
            e.preventDefault();
            zone.style.background = '';
            
            const organ = e.dataTransfer.getData('text/plain');
            const targetOrgan = zone.dataset.organ;
            
            if (organ === targetOrgan) {
              zone.innerHTML = `<span style="color:var(--accent)">✓ ${zone.textContent}</span>`;
              correctMatches++;
              resultDisplay.textContent = `Tepat! ${correctMatches}/${totalMatches} organ ditempatkan dengan benar.`;
              
              // Disable this zone
              zone.style.pointerEvents = 'none';
              
              if (correctMatches === totalMatches) {
                resultDisplay.innerHTML = '<span style="color:var(--accent)">Selamat! Semua organ ditempatkan dengan benar!</span>';
              }
            } else {
              resultDisplay.textContent = 'Coba lagi! Organ tidak cocok dengan sistem ini.';
            }
          });
        });
        
        document.getElementById('endMini3').onclick = () => {
          state.xp += correctMatches * 10;
          state.coins += correctMatches * 5;
          updateHUD();
          alert(`Selesai mini game — +${correctMatches * 10} XP`);
        };
      }
    }

    // ---------- Helpers ----------
    function shuffleArray(a) {
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    
    function humanize(k) {
      return {
        cell: 'Micro Cell World',
        system: 'Human System Lab',
        plant: 'Plant Planet',
        dna: 'DNA Galaxy',
        eco: 'Eco Forest Realm',
        evo: 'Evolution Time Rift'
      }[k] || k;
    }

    // ---------- Init ----------
    initAudio();
    updateHUD();
    renderLeader();
    updateProgress();

    // Resume audio context on first user interact (Chrome autoplay policy)
    document.addEventListener('click', () => {
      if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
      startBackgroundMusic();
    }, { once: true });
  </script>
</body>
</html>
